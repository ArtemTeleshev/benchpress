<div class="container-fluid">
  <div class="row">
    <div class="col-lg-12">
      <h1>Benchpress: {{benchmarkName}}</h1><a href="/#/">Â« all benchmarks</a>
    </div>
  </div>
  <div class="row">
    <div class="col-md-6 col-lg-4 col-sm-12">
      <!-- Nav tabs -->
      <ul class="nav nav-tabs" role="tablist">
        <li ng-repeat="tab in tabs" ng-class="{'active':selectedTab == tab}">
          <a role="tab" ng-click="$parent.selectedTab = tab">
            {{tab}}
          </a>
        </li>
      </ul>
      <!-- Tab panes -->
      <div class="tab-content">
        <div class="tab-pane active" ng-show="selectedTab == 'Controls'">
          <form role="form" class="form-vertical">
            <div class="form-group">
              <label for="runState.numSamples">
                Select number of samples to collect and average:
              </label>
              <input ng-model="runState.numSamples" class="form-control" type="number">
            </div>
          </form>
          <form role="form" class="form-vertical">
            <div class="form-group">
              <label for="runState.context">
                Select context in which the benchmark should run.
              </label>

              <select ng-options="val as key for (key, val) in runContexts" ng-model="runState.context"></select>
              <div class="alert alert-info">
                <span ng-show="runState.context == runContexts.IFRAME">
                  <p>
                    The benchmark will run within a visible iframe within this same window, and will
                    stream result data from the benchmark into the reporting portion of this window.
                    </p>
                    <p>
                    Each test run will create a new iframe, and the iframe will be removed when the
                    test is complete.
                  </p>
                </span>
                <span ng-show="runState.context == runContexts.WINDOW">
                  <p>
                    The benchmark will run within a visible iframe within this same window, and will
                    stream result data from the benchmark into the reporting portion of this window.
                  </p>
                  <p>
                    Each test run will create a new window, and the window will be closed when the
                    test is complete.
                  </p>
                </span>
              </div>
            </div>
          </form>
          <div class="btn-group">
            <button ng-repeat="btn in runBtns"
                    ng-click="ctrl.runBenchmark(btn.value)"
                    ng-bind="btn.label"
                    class="btn btn-default">
            </button>
          </div>
        </div>
        <div class="tab-pane active" ng-show="selectedTab == 'Scripts'">
          <br>
          <p>
            The following scripts can be overridden by adding query params in the current window
            where key is the script's id, and value is the path to the new script to test with.
          </p>
          <table class="scripts table table-striped">
            <thead>
              <tr>
                <th>
                  id to override
                </th>
                <th>
                  current path
                </th>
              </tr>
            </thead>
            <tbody>
              <tr ng-repeat="script in overrideScripts">
                <td>
                  ?{{script.id}}=/custom/path</td>
                <td>{{script.currentPath}}</td>
              </tr>
            </tbody>
          </table>
        </div>
        <div class="tab-pane active" ng-show="selectedTab == 'Tips'">
          <h3>Incognito Recommended</h3>
          <p>
            It's recommended to open a new Incognito Window before each test run/loop.
            Running in Incognito prevents user-added extensions from running, and provides more
            accurate data since optimizations and artifacts that the JavaScript engine may have
            collected from previous test runs will not be present.
          </p>

          <h3>Don't Touch Anything During Runs</h3>
          <p>
            Any user activity, such as scrolling or backgrounding the browser window, could affect the performance of the code under test. Most consistent samples are collected by kicking off a test and keeping hands away from the keyboard and mouse until the test run is finished.
          </p>
        </div>
      </div>
    </div>
  </div>
  <hr>
  <div class="row">
    <div class="col-lg-12">
      <h2>Results:</h2>
      <div class="table table-striped results-table">
        <div class="thead">
          <div class="row headings">
            <div class="th col-md-2 col-md-offset-2">
              test time (ms)
            </div>
            <div class="th col-md-2">
              gc time (ms)
            </div>
            <div class="th col-md-2">
              garbage (KB)
            </div>
            <div class="th col-md-2">
              retained memory (KB)
            </div>
          </div>
        </div>
        <div class="tbody info">
          <div class="row average" ng-repeat="step in steps">
            <div class="td col-md-2 title">
              <h1>{{step.name}}</h1>
              <p>{{step.description}}</p>
            </div>
            <div class="td col-md-2">
              mean: {{ stats[step.name].testTime.avg.mean | number:2 }}ms
              &plusmn; {{ stats[step.name].testTime.avg.coefficientOfVariation * 100 | number:0 }}%
              <br>
              (stddev {{ stats[step.name].testTime.avg.stdDev | number:2 }})
              <br>
              (min {{ stats[step.name].testTime.min | number:2 }} /
               max {{ stats[step.name].testTime.max | number:2 }})
            </div>
            <div class="td col-md-2">
              mean: {{ stats[step.name].gcTime.avg.mean | number:2 }}ms
              <br>
              (combined: {{ (stats[step.name].testTime.avg.mean + stats[step.name].gcTime.avg.mean) | number:2 }}ms)
            </div>
            <div class="td col-md-2">
              mean: {{ (stats[step.name].garbageCount.avg.mean / 1e3) | number:2 }}KB
            </div>
            <div class="td col-md-2">
              mean: {{ (stats[step.name].retainedCount.avg.mean / 1e3) | number:2 }}KB
            </div>
          </div>
          <div class="row scrollable">
            <div class="td col-md-2"
                 ng-repeat="measurement in measurements"
                 ng-class="{'col-md-offset-2':!$index}">
              <div class="sampleContainer">
                <span ng-repeat="result in stats[step.name][measurement].history">
                  {{ result | number:2 }}
                </span>
              </div>
            </div>
          </div>
        </div>
      </div>
      <hr>
    </div>
  </div>
</div>